<!DOCTYPE html>
<html lang="en">
  <head>
    <title>Black Jack</title>
    <meta charset="UTF-8" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://www.w3schools.com/w3css/5/w3.css" />
  </head>
  <body>
    <div class="w3-container w3-center w3-light-green">
      <h1>Black Jack</h1>
    </div>

    <div class="w3-container w3-center w3-green w3-text-black">
      <div id="player-cards">
        <h4>Player's cards:</h4>
        <ul style="display: inline-block;"></ul>
        <p id="player-value"></p>
      </div>
      <div id="buttons">
        <button id="hit" class="w3-btn w3-round-xlarge w3-black">Hit</button>
        <button id="stay" class="w3-btn w3-round-xlarge w3-black">Stay</button>
      </div>
      <div id="dealer-cards">
        <h4>Dealer's cards:</h4>
        <ul style="display: inline-block;"></ul>
        <p id="dealer-value"></p>
      </div>
      <div id="end-of-game">
        <h3></h3>
        <button id="play-again" class="w3-btn w3-round-xlarge w3-black">Play Again</button>
      </div>
    </div>

    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script>
      const socket = io();

      const $playerCards = $("#player-cards ul");
      const $playerValue = $("#player-value");
      const $dealerCards = $("#dealer-cards ul");
      const $dealerValue = $("#dealer-value");
      const $buttons = $("#buttons");
      const $hitBtn = $("#buttons #hit");
      const $stayBtn = $("#buttons #stay");
      const $endGame = $("#end-of-game");
      const $gameResult = $("#end-of-game h2");
      const $playAgainBtn = $("#end-of-game #play-again");

      socket.on("connect", () => {
        $endGame.hide();
        socket.on("players-turn", () => {
          socket.on("display-players-cards", (cards) => {
            $playerCards.empty();
            cards.player.cards.forEach((card) => {
              $("<li></li>").text(card).appendTo($playerCards);
            });
          });
          socket.on("display-dealers-cards", (cards) => {
            $dealerCards.empty();
            cards.dealer.cards.forEach((card) => {
              $dealerCards.append(`<li>${card}</li>`);
            });
          });
          $hitBtn.click(() => {
            socket.emit("hit");
          });
          $stayBtn.click(() => {
            socket.emit("stay");
          });
          socket.on("display-players-value", (cards) => {
            $playerValue.text(
              `Your cards' total value is: ${cards.player.value}`
            );
          });
        });
        socket.on("dealers-turn", () => {
          socket.emit("player-done");
          $buttons.hide();
          socket.on("display-dealers-cards", (cards) => {
            $dealerCards.empty();
            cards.dealer.cards.forEach((card) => {
              $dealerCards.append(`<li>${card}</li>`);
            });
          });
          socket.on("display-dealers-value", (cards) => {
            $dealerValue.text(
              `Your cards' total value is: ${cards.dealer.value}`
            );
          });
        });
      });
      socket.on("win-loss-condition", (condition) => {
        $gameResult.text(condition);
        $endGame.show();
        $playAgainBtn.click( () => {
          location.reload();
        });
      });
    </script>
  </body>
</html>
